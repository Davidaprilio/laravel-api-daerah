class ApiDaerah{#e;elProvinsi;elKecamatan;elKabupaten;elDesa;constructor(e={}){this.#e={baseUrl:e.baseUrl||window.location.origin,event:!1!==e.event,placeholder:!1!==e.placeholder,supportSelectValue:e.supportSelectValue||!1,idProvinsi:e.idProvinsi||"provinsi-select",idKecamatan:e.idKecamatan||"kecamatan-select",idKabupaten:e.idKabupaten||"kabupaten-select",idDesa:e.idDesa||"desa-select",provinsi:{id:e.provinsi?.id||null,dataID:e.provinsi?.dataID||null,value:e.provinsi?.value||"id",text:e.provinsi?.text||"name",selected:e.provinsi?.selected||null,endpoint:e.provinsi?.endpoint||"/api/provinsi"},kabupaten:{id:e.kabupaten?.id||null,dataID:e.kabupaten?.dataID||null,value:e.kabupaten?.value||"id",text:e.kabupaten?.text||"name",selected:e.kabupaten?.selected||null,endpoint:e.kabupaten?.endpoint||"/api/kabupaten/:provinsiID"},kecamatan:{id:e.kecamatan?.id||null,dataID:e.kecamatan?.dataID||null,value:e.kecamatan?.value||"id",text:e.kecamatan?.text||"name",selected:e.kecamatan?.selected||null,endpoint:e.kecamatan?.endpoint||"/api/kecamatan/:kabupatenID"},desa:{id:e.desa?.id||null,dataID:e.desa?.dataID||null,value:e.desa?.value||"id",text:e.desa?.text||"name",selected:e.desa?.selected||null,endpoint:e.desa?.endpoint||"/api/desa/:kecamatanID"},enabled:{kabupaten:!1!==e.enabled?.kabupaten,kecamatan:!1!==e.enabled?.kecamatan,desa:e.enabled?.desa||!1},useJquery:!1},"boolean"!=typeof this.#e.enabled.kabupaten&&(this.#e.enabled.kabupaten=!1!==e.idKabupaten),"boolean"!=typeof this.#e.enabled.kecamatan&&(this.#e.enabled.kecamatan=!1!==e.idKecamatan),"boolean"!=typeof this.#e.enabled.desa&&(this.#e.enabled.desa=!1!==e.idDesa),this.elProvinsi=document.getElementById(this.#e.provinsi.id||this.#e.idProvinsi),this.elKecamatan=document.getElementById(this.#e.kecamatan.id||this.#e.idKecamatan),this.elKabupaten=document.getElementById(this.#e.kabupaten.id||this.#e.idKabupaten),this.elDesa=document.getElementById(this.#e.desa.id||this.#e.idDesa),this.#e.supportSelectValue&&(this.#e.provinsi.selected=this.#e.provinsi.selected||this.elProvinsi?.getAttribute("value")||null,this.#e.kecamatan.selected=this.#e.kecamatan.selected||this.elKecamatan?.getAttribute("value")||null,this.#e.kabupaten.selected=this.#e.kabupaten.selected||this.elKabupaten?.getAttribute("value")||null,this.#e.desa.selected=this.#e.desa.selected||this.elDesa?.getAttribute("value")||null);try{$&&(this.#e.useJquery=!0)}catch(e){this.#e.useJquery=!1}this.#e.event&&this.#t()}#a(e){return this.#e.baseUrl+e}async getProvinsi(){return await this.#n(this.#e.provinsi.endpoint)}async getKabupaten(e){return await this.#n(this.#e.kabupaten.endpoint,{provinsiID:e})}async getKecamatan(e){return await this.#n(this.#e.kecamatan.endpoint,{kabupatenID:e})}async getDesa(e){return await this.#n(this.#e.desa.endpoint,{kecamatanID:e})}async renderProvinsi(e=null){const t=await this.getProvinsi(),a=this.getSelectProvinsiElement();this.#i(a,t,this.#e.provinsi.text,this.#e.provinsi.value,this.#e.provinsi.dataID,e)}async renderKabupaten(e=null,t=null){e=e||this.getSelectedProvinsiID();const a=await this.getKabupaten(e),n=this.getSelectKabupatenElement();this.#i(n,a,this.#e.kabupaten.text,this.#e.kabupaten.value,this.#e.kabupaten.dataID,t)}async renderKecamatan(e=null,t=null){e=e||this.getSelectedKabupatenID();const a=await this.getKecamatan(e),n=this.getSelectKecamatanElement();this.#i(n,a,this.#e.kecamatan.text,this.#e.kecamatan.value,this.#e.kecamatan.dataID,t)}async renderDesa(e=null,t=null){e=e||this.getSelectedKecamatanID();const a=await this.getDesa(e),n=this.getSelectDesaElement();this.#i(n,a,this.#e.desa.text,this.#e.desa.value,this.#e.desa.dataID,t)}getSelectProvinsiElement(){return this.#l("Provinsi")}getSelectKabupatenElement(){return this.#l("Kabupaten")}getSelectKecamatanElement(){return this.#l("Kecamatan")}getSelectDesaElement(){return this.#l("Desa")}getSelectedProvinsiID(){return this.getSelectProvinsiElement().childNodes[this.elProvinsi.selectedIndex].dataset.id}getSelectedKecamatanID(){return this.getSelectKecamatanElement().childNodes[this.elKecamatan.selectedIndex].dataset.id}getSelectedKabupatenID(){return this.getSelectKabupatenElement().childNodes[this.elKabupaten.selectedIndex].dataset.id}getSelectedDesaID(){return this.getSelectDesaElement().childNodes[this.elDesa.selectedIndex].dataset.id}#l(e){try{if(null===this[`el${e}`])throw Error(`${e} Select with id="${this[`el${e}`]}" not found`)}catch(t){if(this.#e.enabled[e])throw t;throw Error(`Cannot get element because element ${e} off/disabled`)}return this[`el${e}`]}getSelectedID(){return{provinsiID:this.getSelectedProvinsiID(),kabupatenID:this.#e.enabled.kabupaten?this.getSelectedKabupatenID():null,kecamatanID:this.#e.enabled.kecamatan?this.getSelectedKecamatanID():null,desaID:this.#e.enabled.desa?this.getSelectedDesaID():null}}#i(e,t,a="name",n="id",i=null,l=null){e.innerHTML="",this.makePlaceholder(e),t.forEach((t=>{const l=this.#s(t,a,n,i);e.appendChild(l)})),null!==l&&(e.value=l)}makePlaceholder(e,t=null,a=!0){if(this.#e.placeholder){e.innerHTML="";const n=document.createElement("option");n.innerText=t||e.getAttribute("placeholder")||"Pilih Lokasi",n.value=t,n.disabled=a,n.selected=!0,e.appendChild(n)}}#s(e,t="name",a="id",n=null){const i=document.createElement("option");return i.innerText=this.#o(e,t),i.dataset.id=this.#o(e,n||a),i.value=this.#o(e,a),i}#o(e,t){try{return t.split(".").reduce(((e,t)=>e[t]),e)}catch(a){console.error(`Invalid key path '${t}'`,e)}}async#n(e,t={}){t={...this.getSelectedID(),...t},e=Object.entries(t).reduce(((e,[t,a])=>e.replaceAll(`:${t}`,a)),e);const a=await fetch(this.#a(e));return await a.json()}async renderAllSelect(e=!1){this.#e.enabled.kabupaten&&this.makePlaceholder(this.getSelectKabupatenElement(),e?this.#e.kabupaten.selected:null,"string"!=typeof this.#e.kabupaten.selected),this.#e.enabled.kecamatan&&this.makePlaceholder(this.getSelectKecamatanElement(),e?this.#e.kecamatan.selected:null,"string"!=typeof this.#e.kecamatan.selected),await this.renderProvinsi(e?this.#e.provinsi.selected:null),this.#e.enabled.kabupaten&&e&&this.#e.kabupaten.selected&&await this.renderKabupaten(null,this.#e.kabupaten.selected),this.#e.enabled.kecamatan&&e&&this.#e.kecamatan.selected&&await this.renderKecamatan(null,this.#e.kecamatan.selected)}#d(e,t){this.#e.useJquery?$(e).on("change",t):e.addEventListener("change",t)}async#t(){const e=this;if(this.makePlaceholder(this.getSelectProvinsiElement(),this.#e.provinsi.selected),this.#e.enabled.kabupaten){const t=this.#e.enabled.kecamatan;this.#d(this.elProvinsi,(()=>{e.makePlaceholder(e.elKabupaten,"Memuat Kabupaten"),e.renderKabupaten(),t&&(e.makePlaceholder(e.elKecamatan),e.#e.enabled.desa&&e.makePlaceholder(e.elDesa))})),this.makePlaceholder(this.getSelectKabupatenElement(),this.#e.kabupaten.selected)}this.#e.enabled.kecamatan&&(this.#d(this.elKabupaten,(()=>{e.makePlaceholder(e.elKecamatan,"Memuat Kecamatan"),e.renderKecamatan(),e.#e.enabled.desa&&e.makePlaceholder(e.elDesa)})),this.makePlaceholder(this.getSelectKecamatanElement(),this.#e.kecamatan.selected)),this.#e.enabled.desa&&(this.#d(this.elKecamatan,(()=>{e.makePlaceholder(e.elDesa,"Memuat Desa"),e.renderDesa()})),this.makePlaceholder(this.getSelectDesaElement(),this.#e.desa.selected)),this.renderAllSelect(!0)}}